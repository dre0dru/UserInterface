### User Interface

- Мне нравится наше текущее разделение на Panel и Popup, но нужно получше продумать эту тему:
    - Возможно стоит выделить еще одну “сущность” в рамках UI - виджеты, переиспользуемые между панелями и попапами элементы UI. Как пример: кнопки героя/домика, которые переиспользуются между панелями и попапами. Сейчас мне не нравится, что добавление этих элементов в панели и попапы создает связь на реализацию презентеров для них в презентерах панелей и попапов, что повлекло за собой нашу проблему в зависимостями в assembly, когда мы удалили все отдельные application ассембли и сделали одну большую
        - Не уверен, просто в некоторых реализациях видел подобное, поэтому просто как идея на подумать
    - Сделать строгую систему слоев, на которых открываются те или иные панели и попапы
        - Сейчас у нас есть пробемы с тем, что есть “логические” слои в игре в виде борды и всего, что на ней происходит и отдельно слои “мета-игры” в виде героя/карточек/домика. Какие собственно проблемы:
            - Пример: снова уменьшим скорость анимации и представим, что у игрока в очереди куча действий по сбору тайлов и в конце действие по переполнению полки с показом попапа “смерти” игрока
                - Так как попап смерти - это попап, то он по нашей логике системы открывается поверх текущего поапапа. Что если игрок успел открыть какой другой попап? Тогда попап смерти будет поверх него.
                    - Доп пример: недавний баг с тем, что попап двери открывался поверх героя/домика и костыльный фикс в виде подписки на закрытие всех попапов
                - Если игрок умер, у нас блокируется весь UI либо блокируются отдельные панели/попапы, что очень неудобно, так как при добавлении новых элементов для блокировки нужно постоянно менять код
                - Соответственно игрок не может пойти в какие другие меню игры
            - Пример: использование хелпера магнита или абилки
                - Блокирует **весь** UI, в том числе возможность открыть попапы героя/карточек/домика, хотя такого в идеале быть не должно
        - Возможность указать на каких слоях будут находиться панели и спавниться попапы
            - Помогает с сортировкой отрисовки, так как каждый отдельный слой - отдельный Canvas
        - Возможность блокировать/игнорировать инпут для определенных слоев
            - Пример: игрок умер, заблокирон инпут для “геймплей” слоя в виде борды, полки, хелперов и абилки, но слой “мета-игры” доступен
            - Можно через общий Canvas Group на слое, можно написать свою систему через кастомный raycast filter (пример в Unmask)
        - Примеры слоев:
            - Геймплей слой
            - Слой мета-игры
            - Слой с “важными” попапами в виде акций, который может вылезти в любой момент игры поверх всего
- Presenter Model - у меня нет у нему претензий вроде как, все еще считаю очень удобным паттерном, который в связке с DI позволяет очень удобно открывать попапы откуда удобно без “проброса” вручную кучи данных в попапы и создания зависимостей на эти данные для проброса в вызывающем коде
    - Я бы поресерчил хорошие примеры других MvX паттернов
        - Mvvm в UI Toolkit, есть несколько хороших семпл проектов от Unity
            - Моя проблема с Mvvm в том, что это по сути реактивный паттерн, что “ломает”
        - Других хороших примеров не знаю
    - Если мы полностью удовлетворены PM паттерном, то я бы сделал более тесную интеграцию нашей Popup/Panel системы с этим паттерном
        - Проброс презентера общим методом сразу при открытии попапа, а не отдельным методом, который каждый раз надо писать вручную
- Tweens
    - Поискать хорошую альтернативу DOTween
        - Закрытый исходный код
        - Уебанский процесс установки через Asset Store в 2024 году
            - Такой же стремной процесс генерации asmdef в каждом новом проекте без возможности сделать ссылку на asmdef в наших кастоных packages, откуда вылезают костыли с необходимостью вручную прописыть defines
        - Лично не нравится внутренний API
        - Аллокации
        - Морально устарел
        - Неудобно писать кастомные твины
    - Да, мы уже попробовали LitMotionn и нам не зашло, но это не повод останавливаться в поиске альтернатив
    - Prime tween (https://github.com/KyryloKuzyk/PrimeTween)
        - Современный, отличный API
        - Без аллокаций
        - API сильно похож на DOTween
        - Устанавливается как package
        - Классные возможности по созданию Sequence
        - Сериализация твинов в инспекторе из коробки (выглядит мега удобно для настройки, а не как сейчас - создание кучи полей вручную)
- Работа с эффектами (партиклами) и отложенной визуализацией
    - У нас общей системы для такого, для каждого случая пишем код копипастой с подгонкой под текущий контекст
    - Много проблем, когда нужно миксовать реактивность и отложенную визуализацию:
        - Пример: каждый раз вручую вызываем PlayerResourcesPanel.Refresh(), когда в других местах добавляем ресурсы
            - То есть нужна система с разделением на контексты или типо того. В текущем контексте анимируем отложеннно (то есть текущий экран, на котором находимся), а в остальных “неактивных” контекстах меняем значения реактивно
        - Пример: проблема с разделением изменений домена на шаги для анимаций. Когда добавили получение софты за оставшиеся на поле тайлы была проблема с тем, что в домене уже применена награда за эти тайлы + награда за завершение локации, однако отобразить начисление в топ баре нужно было отдельно
            - Возник костыль в виде кеширования значения софты за оставшиеся тайлы
            - Возможно нужна опять же очередь визуализации, возможно некоторая View Model (не паттерн), то есть внутренняя модель состояния UI/View
                - Пример такой ad-hoc модели у нас: кеширование currentValue в топ баре с валютой, которое увеличиваем по вызову метода и анимируем в твине

Компонент с дефолтным слоем, который просто возвращает нужный рект
Поддержка слоев из коробки, то есть из контроллеров

Поддержка PM из коробки или как отдельная реализация контроллера

идея такая:
верхоуровневый контроллер, который знает про слои
слои - чуть ниже уровнем и собственно менеджат открытые попапы и панели


не забыть про Lock/Unlock слоев, то ли из коробки сделать
то ли отдельный компонент + интерфейс
скорее всего как интерфейс, так как подраззумевается наследование и кастомные интерфейсы свои
